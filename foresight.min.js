(function(a,b,c,d){"use strict";a.images=[];a.options=a.options||{};var e=a.options,f=e.testConn||true,g=e.minKbpsForHighBandwidth||300,h=e.speedTestUri||"http://foresightjs.appspot.com/speed-test/50K",i=e.speedTestKB||50,j=e.speedTestExpireMinutes||30,k=e.hiResClassname||"fs-high-resolution",l=e.lowResClassname||"fs-standard-resolution",m="devicePixelRatio",n="devicePixelRatioRounded",o="bandwidth",p="connType",q="connTestResult",r="connKbps",s="requestChange",t="highResolutionSrc",u="browserWidth",v="browserHeight",w="requestWidth",x="requestHeight",y="width",z="height",A="widthUnits",B="heightUnits",C="appliedImageSetItem",D="scale",E="scaleRounded",F="uriTemplate",G="uriFind",H="uriReplace",I="srcModification",J="loading",K="complete",L="fsjs",M=true,N=false,O=/url\((?:([a-zA-Z-_0-9{}\?=&\\/.:\s]+)|([a-zA-Z-_0-9{}\?=&\\/.:\s]+)\|([a-zA-Z-_0-9{}\?=&\\/.:\s]+))\)/g,P,Q,R=function(){if(P)return;P=J;S();P=K;W()},S=function(){var b,d,e,f;for(b=0;b<c.images.length;b++){d=c.images[b];if(d.initalized)continue;d.initalized=M;d.orgSrc=V(d,"src");d[A]=V(d,y,M);d[B]=V(d,z,M);if(!d.orgSrc||!d[A]||!d[B])continue;d[w]=0;d[x]=0;d[t]=V(d,"high-resolution-src");d.orgClassName=d.className?d.className:"";f=_(d,"font-family","fontFamily").split("image-set(");d.imageSet=[];if(f.length>1){T(d,f[1])}d.onerror=bf;a.images.push(d)}},T=function(a,b){var c,d=b.split(","),e,f,g;for(c=0;c<d.length;c++){e={text:d[c]};g=0;if(e.text.indexOf(" 1.5x")>-1){g++;e[D]=1.5}else if(e.text.indexOf(" 2x")>-1){e[D]=2}else if(e.text.indexOf(" 1x")>-1){e[D]=1}if(e.text.indexOf(" high-bandwidth")>-1){e[o]="high"}else if(e.text.indexOf(" low-bandwidth")>-1){e[o]="low"}while(f=O.exec(e.text)){if(f[1]!=null&&f[1]!==""){e[F]=f[1];g++}else if(f[2]!=null&&f[2]!==""){e[G]=f[2];e[H]=f[3];g++}}if(e[D]&&e[o]){g+=2}else if(e[D]||e[o]){g++}e.weight=g;a.imageSet.push(e)}a.imageSet.sort(U)},U=function(a,b){if(a.weight<b.weight)return 1;if(a.weight>b.weight)return-1;return 0},V=function(a,b,c,d){d=a.getAttribute("data-"+b);if(c){if(!isNaN(d)){return parseInt(d,10)}return 0}return d},W=function(){if(!(Q===K&&P===K))return;var b,c=a.images.length,d,e,f,g,h,i,j=[],m;for(b=0;b<c;b++){d=a.images[b];if(!Y(d)){continue}h=d.orgClassName.split(" ");Z(d);if(d.unitType=="pixel"){i="fs-"+d[u]+"x"+d[v];h.push(i);j.push("."+i+"{width:"+d[u]+"px;height:"+d[v]+"px}")}if(d.style.display!=="inline"){d.style.display="inline"}X(d);if(d[C][D]>1&&d[C][o]==="high"){e=Math.round(d[u]*d[C][D]);f=Math.round(d[v]*d[C][D]);a.hiResEnabled=M}else{e=d[u];f=d[v];a.hiResEnabled=N}if(e>d[w]){d[w]=e;d[x]=f;if(d[t]&&a.hiResEnabled){d.src=d[t];d[I]="src-hi-res"}else if(d[C][F]){bc(d);d[I]="src-uri-template"}else if(d[C][G]&&d[C][H]){be(d);d[I]="src-find-replace"}else{d.src=d.orgSrc;d[I]="src-original"}d[s]=M}else{d[s]=N}if(a.hiResEnabled&&d.src!==d.orgSrc){h.push(k)}else{h.push(l)}h.push("fs-"+d[I]);d.className=h.join(" ")}if(j.length){bb(j)}if(a.updateComplete){a.updateComplete()}bj=bl()},X=function(b){var c,d,e={};for(c=0;c<b.imageSet.length;c++){d=b.imageSet[c];if(d[D]&&d[o]){if(a[m]==d[D]&&a[o]===d[o]){e=d;break}else if(Math.round(a[m])==d[D]&&a[o]===d[o]){e=d;break}}else if(d[D]){if(a[m]==d[D]){e=d;break}else if(Math.round(a[m])==d[D]){e=d;break}}else if(d[o]){if(a[o]===d[o]){e=d;break}}else{e=d}}if(!e[D]){e[D]=a[m]}if(!e[o]){e[o]=a[o]}e[E]=Math.round(e[D]);b[C]=e},Y=function(a,b){b=a.parentElement;if(b.clientWidth){return M}if(_(b,"display")==="inline"){return Y(b)}return N},Z=function(a,b){if(!a.unitType){b=_(a,y);if(b.indexOf("%")>0){a.unitType="percent"}else{a.unitType="pixel";a[u]=a[A];a[v]=a[B]}}if(a.unitType==="percent"){a.computedWidth=$(a);a[u]=a.computedWidth;a[v]=Math.round(a[B]*(a.computedWidth/a[A]));a.style.height=a[v]+"px"}},$=function(a){if(a.offsetWidth!==0){return a.offsetWidth}else{var b,c,d={},e={position:"absolute",visibility:"hidden",display:"block"};for(c in e){d[c]=a.style[c];a.style[c]=e[c]}b=a.offsetWidth;for(c in e){a.style[c]=d[c]}return b}},_=function(a,b,d){if(!d){d=b}return a.currentStyle?a.currentStyle[d]:c.defaultView.getComputedStyle(a,null).getPropertyValue(b)},ba,bb=function(a,b){if(!ba){ba=c.createElement("style");ba.setAttribute("type","text/css")}b=a.join("");try{ba.innerText=b}catch(d){ba.styleSheet.cssText=b}if(ba.parentElement==null){c.getElementsByTagName("head")[0].appendChild(ba)}},bc=function(a){var b,c=["src","protocol","host","port","directory","file","filename","ext","query",w,x,D,E],d=a[C][F];a.uri=bd(a.orgSrc);a.uri.src=a.orgSrc;a.uri[w]=a[w];a.uri[x]=a[x];a.uri[D]=a[C][D];a.uri[E]=a[C][E];for(b=0;b<c.length;b++){d=d.replace("{"+c[b]+"}",a.uri[c[b]])}a.src=d},bd=function(a){var b={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},c=b.parser.exec(a),d={},e=14;while(e--)d[b.key[e]]=c[e]||"";d[b.q.name]={};d[b.key[12]].replace(b.q.parser,function(a,c,e){if(c)d[b.q.name][c]=e});var f=d.file.split(".");d.filename=f[0];d.ext=f.length>1?f[f.length-1]:"";return d},be=function(a){var b=a[C][G].replace("{browserWidth}",a[A]).replace("{browserHeight}",a[B]);var c,d=a.orgSrc.replace(b,a[C][H]),e=[w,x,D,E];for(c=0;c<e.length;c++){d=d.replace("{"+e[c]+"}",a[e[c]])}a.src=d},bf=function(a){a=this;a.className=a.className.replace(k,l);a[I]="response-error";if(a.hasError||a.src===a.orgSrc)return;a.hasError=M;a.src=a.orgSrc},bg=function(){if(Q)return;if(e.forcedBandwidth){a[o]=e.forcedBandwidth;a[q]="forced";Q=K;return}if(a[m]===1){a[q]="skip";Q=K;return}var b=d.connection||{type:"unknown"};var f=b.type==3||b.type==4||/^[23]g$/.test(b.type);a[p]=b.type;if(f){a[q]="connTypeSlow";Q=K;return}try{var j=JSON.parse(localStorage.getItem(L));if(j!==null){if((new Date).getTime()<j.exp){a[o]=j.bw;a[r]=j.kbps;a[q]="localStorage";Q=K;return}}}catch(k){}var l=c.createElement("img"),n,s,t;l.onload=function(){n=(new Date).getTime();var b=(n-s)/1e3;b=b>1?b:1;a[r]=i*1024*8/b/1024;a[o]=a[r]>=g?"high":"low";bh("networkSuccess")};l.onerror=function(){bh("networkError",5)};l.onabort=function(){bh("networkAbort",5)};s=(new Date).getTime();Q=J;if(c.location.protocol==="https:"){h=h.replace("http:","https:")}l.src=h+"?r="+Math.random();t=i*8/g*1e3+350;setTimeout(function(){bh("networkSlow")},t)},bh=function(b,c){if(Q===K)return;Q=K;a[q]=b;try{if(!c){c=j}var d={kbps:a[r],bw:a[o],exp:(new Date).getTime()+c*6e4};localStorage.setItem(L,JSON.stringify(d))}catch(e){}W()},bi=function(){if(b.addEventListener){b.addEventListener("resize",bk,N)}else if(b.attachEvent){b.attachEvent("onresize",bk)}},bj=0,bk=function(){if(bj!==bl()){a.reload()}},bl=function(){return c.documentElement.clientWidth||c.body&&c.body.clientWidth||1024},bm,bn=function(){if(P!==K||Q!==K)return;S();W()};a.reload=function(){b.clearTimeout(bm);bm=b.setTimeout(bn,250)};a.ready=function(){if(!c.body){return b.setTimeout(ready,1)}R()};if(c.readyState===K){setTimeout(fsReady,1)}else{if(c.addEventListener){c.addEventListener("DOMContentLoaded",a.ready,N);b.addEventListener("load",a.ready,N)}else if(c.attachEvent){c.attachEvent("onreadystatechange",a.ready);b.attachEvent("onload",a.ready)}}a[m]=b[m]?b[m]:1;if(e.forcedPixelRatio){a[m]=e.forcedPixelRatio}a[n]=Math.round(a[m]);bg();bi()})(this.foresight=this.foresight||{},this,document,navigator)